# 1st stage - install dependencies
FROM node:16-alpine3.11 as builder
WORKDIR /usr/app/discord
COPY discord/package*.json .
RUN npm install
COPY discord/ .


# 2nd stage - compile typescript
FROM builder as npm
WORKDIR /usr/app/discord
COPY common /usr/app/common
COPY @types /usr/app/@types
COPY discord/tsconfig.discord.json ./tsconfig.discord.json
COPY discord/package*.json .
RUN npm install --production
RUN npm run build

FROM node:16-alpine3.11
WORKDIR /usr/app/discord
COPY --from=npm /usr/app/discord/dist ./dist
COPY --from=npm /usr/app/discord/package.json ./package.json
COPY common /usr/app/common
COPY @types /usr/app/@types


CMD ["npm", "run", "dev"]