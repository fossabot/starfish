FROM node:16-alpine3.11 as base

ENV HOST 0.0.0.0

WORKDIR /usr/app/frontend

COPY package.json .

FROM base AS npm_install
RUN npm install

FROM  npm_install as npm_build
WORKDIR /usr/app/frontend
COPY --from=npm_install /usr/app/frontend/node_modules /usr/app/frontend/node_modules

ADD @types/ /usr/app/@types
ADD common/ /usr/app/common
ADD . /usr/app/frontend

# RUN chown -R node:root /usr/app/frontend
# RUN chmod -R 755 /usr/app/frontend/

CMD ["npm", "run", "start"]
