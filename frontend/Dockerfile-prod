FROM node:16-alpine3.11 as base

WORKDIR /usr/app/frontend
COPY package*.json .
RUN npm install

FROM base as npmbuild
WORKDIR /usr/app/frontend
COPY . /usr/app/frontend
COPY common /usr/app/common
COPY @types /usr/app/@types
RUN npm run build

FROM node:16-alpine3.11 as release
COPY --from=npmbuild /usr/app /usr/app
ENV HOST 0.0.0.0
RUN chown node:root /usr/app/frontend
RUN chmod -R 777 /usr/app/frontend/.nuxt

CMD ["npm", "start"]
#"run", "dev"]
